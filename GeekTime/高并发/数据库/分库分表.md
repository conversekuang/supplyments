



分库分表：



<img src="https://static001.geekbang.org/resource/image/05/23/05fa7f7a861ebedc4d8f0c57bc88b023.jpg" style="zoom:30%">

**读写分离**：它就是依靠主从复制的技术使得数据库实现了数据复制为多份

**特点**：

- 增强了抵抗大量并发读请求的能力，提升了数据库的查询性能的同时
- 提升了数据的安全性。当某一个数据库节点，无论是主库还是从库发生故障时，我们还有其他的节点中存储着全量的数据，保证数据不会丢失。



当订单流量激增的情况，几个亿，会出现查询和写入，存储都会出现瓶颈。

订单数据都是单表存储的，你的压力倍增，数据库读写性能下降。



**存在的问题**：

- 数据库占据大量磁盘，如何让数据库支持如此大的数据量？
- 模块的故障隔离？【当用户表和关系表在一库中】
- 更高的并发请求？
- 更高的查询性能？



**解决问题**：

​	这些问题你可以归纳成，数据库的写入请求量大造成的性能和可用性方面的问题，要解决这些问题，你所采取的措施就是对数据进行分片。



**方式**：

分库分表是一种常见的将数据分片的方式，它的基本思想是依照某一种策略将数据尽量平均地分配到多个数据库节点或者多个表中



**垂直拆分**：

在微博系统中有和用户相关的表，有和内容相关的表，有和关系相关的表，这些表都存储在**主库中**。

在拆分后，我们期望用户相关的表分拆到用户库中，内容相关的表分拆到**内容库**中，关系相关的表分拆到**关系库**中。

<img src = "https://static001.geekbang.org/resource/image/77/40/7774c9393a6295b2d5e0f1a9fa7a5940.jpg" style="zoom:30%">

缺点：

单一的数据库或者数据表已经远远不能满足存储和查询的需求了，这个时候，你需要将数据拆分到多个数据库和数据表中，也就是对数据库和数据表做水平拆分了。



**水平拆分**：

水平拆分指的是将单一数据表按照某一种规则拆分到多个数据库和多个数据表中，关注点在数据的特点。



**方式**：

1.  按照某一个字段的哈希值做拆分，这种拆分规则比较适用于实体表，
2. 另一种比较常用的是按照某一个字段的区间来拆分，比较常用的是时间字段。【一个月一张表】



**分库分表引入的问题**：

- 确定分库分表键

分库分表引入的一个最大的问题就是引入了**分库分表键**，也叫做分区键，也就是我们对数据库做分库分表所依据的字段。

我们之后**所有的查询都需要带上这个字段，才能找到数据所在的库和表**，否则就只能向所有的数据库和数据表发送查询命令。



- 数据库的特性实现

  - 多表的查询Join 【把两个表的数据取出后在业务代码里面做筛选，复杂是有一些，不过是可以实现的】

  - count操作 【将计数的数据单独存储在一张表中或者记录在 Redis 】



- 主键的全局唯一性问题



分库分表原则：

- 性能上没有瓶颈就不做
- 做一次就能管几年
- NoSQL代替RDB



**你在使用一个方案解决一个问题的时候一定要弄清楚原理，搞清楚这个方案会带来什么问题，要如何来解决，要知其然也知其所以然，这样才能在解决问题的同时避免踩坑。**





