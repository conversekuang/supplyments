



#### Cache Aside（旁路缓存）策略

Cache Aside 策略（也叫旁路缓存策略），这个策略数据以数据库中的数据为准，缓存中的数据是按需加载的。它可以分为读策略和写策略

- 其中读策略的步骤是：
  - 从缓存中读取数据；
  - 如果缓存命中，则直接返回数据；
  - 如果缓存不命中，则从数据库中查询数据；
  - 查询到数据后，将数据写入到缓存中，并且返回给用户。
- 写策略的步骤是：
  - 更新数据库中的记录；
  - 删除缓存记录。



缺点：

当写入比较频繁的时候，缓存中的数据会被频繁的清理。



#### Read/Write Through（读穿 / 写穿）策略

这个策略的核心原则是**用户只与缓存打交道**，由缓存和数据库通信，写入或者读取数据。



Write Through 策略：

- 先查询要写入的数据在缓存中是否已经存在，如果已经存在，则**更新缓存中的数据**，并且由**缓存组件同步更新到数据库**中
- 如果缓存中数据不存在，我们把这种情况叫做“Write Miss（写失效）”
  - “Write Allocate（按写分配）”：做法是写入缓存**相应位置**，再由缓存组件同步更新到数据库中
  - “No-write allocate（不按写分配）”：做法是不写入缓存中，而是直接更新到数据库中。【优先】



Read Through 策略：

- 先查询缓存中数据是否存在，如果存在则直接返回
- 如果不存在，则由缓存组件负责从数据库中同步加载数据。



#### Write Back（写回）策略

Write Back 策略的话，写策略：

- 在写入数据时只写入缓存，并且把缓存块儿标记为“脏”的。而脏块儿只有被再次使用时才会将其中的数据写入到后端存储中。



Write Back 策略的话，读的策略也有一些变化了

- 我们在读取缓存时如果发现缓存命中则直接返回缓存数据。

- 如果缓存不命中则寻找一个可用的缓存块儿，
  - 如果这个缓存块儿是“脏”的，就把缓存块儿中之前的数据写入到后端存储中，并且从后端存储加载数据到缓存块儿，
  - 如果不是脏的，则由缓存组件将后端存储中的数据加载到缓存中，最后我们将缓存设置为不是脏的，返回数据就好了。

